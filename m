Return-Path: <linux-hyperv-owner@vger.kernel.org>
X-Original-To: lists+linux-hyperv@lfdr.de
Delivered-To: lists+linux-hyperv@lfdr.de
Received: from vger.kernel.org (vger.kernel.org [23.128.96.18])
	by mail.lfdr.de (Postfix) with ESMTP id 382562B2734
	for <lists+linux-hyperv@lfdr.de>; Fri, 13 Nov 2020 22:39:47 +0100 (CET)
Received: (majordomo@vger.kernel.org) by vger.kernel.org via listexpand
        id S1726177AbgKMVjp (ORCPT <rfc822;lists+linux-hyperv@lfdr.de>);
        Fri, 13 Nov 2020 16:39:45 -0500
Received: from lindbergh.monkeyblade.net ([23.128.96.19]:42554 "EHLO
        lindbergh.monkeyblade.net" rhost-flags-OK-OK-OK-OK) by vger.kernel.org
        with ESMTP id S1725981AbgKMVjo (ORCPT
        <rfc822;linux-hyperv@vger.kernel.org>);
        Fri, 13 Nov 2020 16:39:44 -0500
Received: from mail-ed1-x541.google.com (mail-ed1-x541.google.com [IPv6:2a00:1450:4864:20::541])
        by lindbergh.monkeyblade.net (Postfix) with ESMTPS id CA065C0613D1;
        Fri, 13 Nov 2020 13:39:42 -0800 (PST)
Received: by mail-ed1-x541.google.com with SMTP id v22so12454080edt.9;
        Fri, 13 Nov 2020 13:39:42 -0800 (PST)
DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed;
        d=gmail.com; s=20161025;
        h=date:from:to:cc:subject:message-id:references:mime-version
         :content-disposition:in-reply-to;
        bh=GY3sxkg3pkqNwc0wL90fxKYZ45EqrlmAu69mRryF7BM=;
        b=QsOQMrz4ShhUlES7isqspW1o38dZdZLYZ3bnw/pYncm8p7NSiCAur8hXoz+MgjoiuC
         oUETvqL8Opp+A5mRL77tkDmyeoUJNPzhRbwP6sXK/suo4a30oJdLx9sJeV/3wK4idJTP
         JWktnT9+kU1yb9FdiQ/6HgFNF9DgVoDBa7gNEMmUojuVjHGxxC4GinQVDn682o7A6doU
         9HDipvWp0f8ln8xzFQsMcUyd+GdzzOBg6okpdp3D6gkxDVaD0AOEeSGzPgyS0+PK7z9i
         z6o6KrTmsKKq/6t5c+vWvRpnBrCbo1pzb9ZmO3VXiQIddCjjIxW4yiu+iaU0/Wh0veSb
         ZhBQ==
X-Google-DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed;
        d=1e100.net; s=20161025;
        h=x-gm-message-state:date:from:to:cc:subject:message-id:references
         :mime-version:content-disposition:in-reply-to;
        bh=GY3sxkg3pkqNwc0wL90fxKYZ45EqrlmAu69mRryF7BM=;
        b=sfSHKQldyK/Yx1/IokCI+jLf5SsgleKXhcFYLU6nzDHCr8po7JtRO3XaV6L1XOTTgS
         a6piG2rIwtfYrqud/gm7EbRiD6KI1EKbN8A2Nv+rjDP5aYFJoBqO5ibh+FIBi4C2KZJa
         B9fEKtIj3p24/cjeeMmrYApqLYnRos6gpa+7yXeHt+ynq3dIdxwA7d/t6GTmqWNL3Qjz
         yNcTi/XLwp6DsEhV+VDIMHc/r/sZDHU0HUZcbkuPZdg1gNqGBC/vVtoqrPbVq1B37e8m
         8sNYExgfkYe1Yt2A55D28WQomzTdlFdjZyrqndCmxzfNn5Jk0+r3K9Gwy1Nni2vXaQKR
         I3Sg==
X-Gm-Message-State: AOAM532p7tplJdcHBt7IZRt2IKxt2Tl3yOT7blRDRuo+spxH2V0bn4pd
        jcZrh5AMliszDg+IcucqiW8=
X-Google-Smtp-Source: ABdhPJxvP333YF/+k+Gwi+3JjsWYJs7f8n+Vq0nNrbugFBnqg0LfQdeG/4azufOrmOGtRssqLNnT9Q==
X-Received: by 2002:a50:f392:: with SMTP id g18mr4798636edm.140.1605303581324;
        Fri, 13 Nov 2020 13:39:41 -0800 (PST)
Received: from andrea (host-82-51-6-75.retail.telecomitalia.it. [82.51.6.75])
        by smtp.gmail.com with ESMTPSA id p26sm3095853eja.13.2020.11.13.13.39.39
        (version=TLS1_3 cipher=TLS_AES_256_GCM_SHA384 bits=256/256);
        Fri, 13 Nov 2020 13:39:40 -0800 (PST)
Date:   Fri, 13 Nov 2020 22:39:33 +0100
From:   Andrea Parri <parri.andrea@gmail.com>
To:     Wei Liu <wei.liu@kernel.org>
Cc:     linux-kernel@vger.kernel.org,
        "K . Y . Srinivasan" <kys@microsoft.com>,
        Haiyang Zhang <haiyangz@microsoft.com>,
        Stephen Hemminger <sthemmin@microsoft.com>,
        linux-hyperv@vger.kernel.org, Andres Beltran <lkmlabelt@gmail.com>,
        Michael Kelley <mikelley@microsoft.com>,
        Saruhan Karademir <skarade@microsoft.com>,
        Juan Vazquez <juvazq@microsoft.com>,
        "James E.J. Bottomley" <jejb@linux.ibm.com>,
        "Martin K. Petersen" <martin.petersen@oracle.com>,
        linux-scsi@vger.kernel.org
Subject: Re: [PATCH v9 2/3] scsi: storvsc: Use vmbus_requestor to generate
 transaction IDs for VMBus hardening
Message-ID: <20201113213933.GA4937@andrea>
References: <20201109100402.8946-1-parri.andrea@gmail.com>
 <20201109100402.8946-3-parri.andrea@gmail.com>
 <20201113113327.dmium67e32iadqbz@liuwe-devbox-debian-v2>
 <20201113185424.ujdfx6ot7siqr5qh@liuwe-devbox-debian-v2>
MIME-Version: 1.0
Content-Type: text/plain; charset=us-ascii
Content-Disposition: inline
In-Reply-To: <20201113185424.ujdfx6ot7siqr5qh@liuwe-devbox-debian-v2>
Precedence: bulk
List-ID: <linux-hyperv.vger.kernel.org>
X-Mailing-List: linux-hyperv@vger.kernel.org

On Fri, Nov 13, 2020 at 06:54:24PM +0000, Wei Liu wrote:
> On Fri, Nov 13, 2020 at 11:33:27AM +0000, Wei Liu wrote:
> > On Mon, Nov 09, 2020 at 11:04:01AM +0100, Andrea Parri (Microsoft) wrote:
> > > From: Andres Beltran <lkmlabelt@gmail.com>
> > > 
> > > Currently, pointers to guest memory are passed to Hyper-V as
> > > transaction IDs in storvsc. In the face of errors or malicious
> > > behavior in Hyper-V, storvsc should not expose or trust the transaction
> > > IDs returned by Hyper-V to be valid guest memory addresses. Instead,
> > > use small integers generated by vmbus_requestor as requests
> > > (transaction) IDs.
> > > 
> > > Signed-off-by: Andres Beltran <lkmlabelt@gmail.com>
> > > Co-developed-by: Andrea Parri (Microsoft) <parri.andrea@gmail.com>
> > > Signed-off-by: Andrea Parri (Microsoft) <parri.andrea@gmail.com>
> > > Reviewed-by: Michael Kelley <mikelley@microsoft.com>
> > > Cc: "James E.J. Bottomley" <jejb@linux.ibm.com>
> > > Cc: "Martin K. Petersen" <martin.petersen@oracle.com>
> > > Cc: linux-scsi@vger.kernel.org
> > 
> > Reviewed-by: Wei Liu <wl@xen.org>
> 
> Martin already gave his ack back in July. I guess nothing substantial
> changed so it should have been carried over?

The only change here happened in v7 and consisted in moving the
allocation of the request IDs from the VSC code down into the core
vmbus_sendpacket()&co functions.  As mentioned in v7 cover letter,
this change was applied to ensure that the allocation in question
is performed after the packet is copied into the ring buffer.  On
a positive note, this change greatly reduced the diff of this and
the following (NetVSC) patches.

  Andrea
